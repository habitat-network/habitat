tasks:
  build:
    deps:
      - "root:build"
  dev:
    command: "noop"
    deps:
      - target: "privi:start"
        env:
          HABITAT_PORT: "8000"
          HABITAT_DEBUG: "true"
      - target: "funnel:start"
        args: ["8000", "privi"]
      - target: "funnel:start"
        args: ["5173", "frontend"]
      - target: "frontend:start"

  build-makefile-linux:
    command: "go build"
    args:
      - "-o"
      - "@out(0)"
    outputs:
      - "/bin/amd64-linux/habitat"
    options:
      cache: false
      runInCI: false
    env:
      GOOS: "linux"
      GOARCH: "amd64"

  build-makefile-darwin:
    command: "go build"
    args:
      - "-o"
      - "@out(0)"
    outputs:
      - "/bin/amd64-darwin/habitat"
    options:
      cache: false
      runInCI: false
    env:
      GOOS: "darwin"
      GOARCH: "arm64"
